<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The ball</title>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.3.1/lib/p5.js"></script>
  <script>
let ogBallWidth = 30;
let ogBallHeight = 30;

let ballWidth = ogBallWidth;
let ballHeight = ogBallHeight;

let xpos;
let ypos;

let xspeed = 0;
let yspeed = 0.1;

let gravity = 0.4;

// let hasHitBottom = false;
// let hasHitTop = false;
// let hasHitLeft = false;
// let hasHitRight = false;

let rectWidth = 15;
let rectHeight = 15;

let rectX;
let rectY;

let captured = true;

let hasStarted = false;

function setup()
{
  let canvas = createCanvas(windowWidth*0.9, windowHeight*0.9);
  canvas.position(windowWidth/2 - width/2, (windowHeight - height)/2);
  noStroke();

  xpos = width/2;
  ypos = height - ballHeight/2;
}

function draw()
{
  springBack();

  let ballColor = color(255, 145, 0);
  let rectColor = color(0, 255, 0);
  let back = color(0, 165, 255);
  background(back);

  if(!hasStarted)
  {
    fill(color(0));
    textSize(50);
    text('Use the arrows to move the ball to eat the square.', width/2 - width/4, height/6, width/2, height/4)
  }

  if(ogBallWidth > width/2.5)
  {
    ballWidth = 0;
    ballHeight = 0;
    rectWidth = 0;
    let textColor = color(0);
    fill(textColor);
    textSize(50);
    text('Good Job. You won.', width/2 - width/4, height/6, width/2, height/4);
    noLoop();
  }

  yspeed += gravity;
  ypos += yspeed;
  xpos += xspeed;

  eatRect();

  if(captured)
  {
    rectX = random(0, width - rectWidth);
    rectY = random(0, height - rectHeight);
    captured = false;
  }

  bounceBottom();
  bounceTop();
  bounceLeft();
  bounceRight();

  fill(rectColor);
  rect(rectX, rectY, rectWidth)

  fill(ballColor);
  ellipse(xpos, ypos, ballWidth, ballHeight);
}

function springBack()
{
  if(ypos <= height - ballHeight/2 || ypos >= ballHeight/2 || xpos <= width - ballWidth/2 || xpos >= ballWidth/2)
  {
    // hasHitBottom = false;
    // hasHitTop = false;
    // hasHitLeft = false;
    // hasHitRight = false;

    ballHeight = ogBallHeight;
    ballWidth = ogBallWidth;
  }
}

function keyPressed()
{
  hasStarted = true;
  if(keyCode === UP_ARROW)
  {
    yspeed = -8;
  }

  if(keyCode === LEFT_ARROW)
  {
    xspeed -= 2;
  }

  if(keyCode === RIGHT_ARROW)
  {
    xspeed += 2;
  }

  // if(keyCode === RETURN)
  // {
  //   xspeed = random(-10, 10);
  //   yspeed = random(-5, -20);
  // }
}

function bounceBottom()
{
  if(ypos + ballHeight/2 > height)
  {
    ballHeight *= 1 - (yspeed * .001);
    ballWidth *= 1 + (yspeed * .001);
    // hasHitBottom = true;
    ypos = height - ballHeight/2;
    yspeed *= -0.6;
    xspeed *= 0.995;
  }
  if(ypos + ballHeight/2 === height)
  {
    xspeed *= 0.995;
  }
}

function bounceTop()
{
  if(ypos < ballHeight/2)
  {
    ballHeight *= 1 - (-yspeed * .001);
    ballWidth *= 1 + (-yspeed * .001);
    // hasHitTop = true;
    ypos = ballHeight/2;
    yspeed *= -0.6;
    xspeed *= 0.995;
  }
}

function bounceLeft()
{
  if(xpos < ballWidth/2)
  {
    ballHeight *= 1 + (-xspeed * .001);
    ballWidth *= 1 - (-xspeed * .001);
    // hasHitLeft = true;
    xpos = ballHeight/2;
    xspeed *= -0.6;
    yspeed *= 0.995;
  }
}

function bounceRight()
{
  if(xpos + ballWidth/2 > width)
  {
    ballHeight *= 1 + (yspeed * .001);
    ballWidth *= 1 - (yspeed * .001);
    // hasHitRight = true;
    xpos = width - ballHeight/2;
    xspeed *= -0.6;
    yspeed *= 0.995;
  }
}

function eatRect()
{
  if(xpos + ballWidth/2 > rectX + rectWidth && xpos - ballWidth/2 < rectX && ypos + ballHeight/2 > rectY + rectHeight && ypos - ballHeight/2 < rectY)
  {
    captured = true;
    ogBallWidth *= 1.2;
    ogBallHeight *= 1.2;
  }
}
  </script>
</head>

<body>
  <main>
  </main>
</body>

</html>
